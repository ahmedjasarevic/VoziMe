<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:maps="clr-namespace:Microsoft.Maui.Controls.Maps;assembly=Microsoft.Maui.Controls.Maps"
             x:Class="VoziMe.Views.DriverSelectionPage"
             NavigationPage.HasNavigationBar="False">

    <Grid x:Name="MainGrid"
          RowDefinitions="Auto, *, Auto">

        <!-- Mapa sa pretragom -->
        <Grid x:Name="MapArea"

              Grid.Row="1"
              VerticalOptions="FillAndExpand">

            <maps:Map x:Name="LocationMap"
                      IsShowingUser="True"
                      MapType="Street"
                      VerticalOptions="FillAndExpand"
                      HorizontalOptions="FillAndExpand" />

            <!-- Unos lokacija -->
            <StackLayout Padding="20" VerticalOptions="Start">
                <Frame BackgroundColor="White" CornerRadius="25" Padding="10,5" WidthRequest="300" >
                    <Entry x:Name="SourceEntry" Placeholder="Unesite lokaciju" Completed="SourceEntry_Completed" TextColor="Black" />
                </Frame>
                <Frame BackgroundColor="White" WidthRequest="300"

CornerRadius="25" Padding="10,5" Margin="0,10,0,0">
                    <Entry x:Name="DestinationEntry" Placeholder="Unesite destinaciju" TextColor="Black" />
                </Frame>
            </StackLayout>
        </Grid>

        <!-- Dugme pri dnu (fiksirano) -->
        <Button x:Name="ShowDriversButton"
                Grid.Row="2"
                Text="Odaberite vozača"
                BackgroundColor="#FF4444"
                TextColor="White"
                FontSize="16"
                CornerRadius="25"
                Padding="10"
                HeightRequest="50"
                Margin="15"
                

Clicked="ShowDriversButton_Clicked" />

        <!-- Bottom Sheet - Panel za vozače -->
        <Frame x:Name="BottomSheet"
               IsVisible="False"
               BackgroundColor="#222222"
               CornerRadius="20"
               Padding="15"
               Grid.RowSpan="3"
               VerticalOptions="End"
               HeightRequest="400"
               Margin="0">
            <ScrollView>
                <StackLayout>
                <Label Text="Odaberite vozača"
                       TextColor="White"
                       FontSize="20"
                       HorizontalOptions="Center"
                       Margin="0,0,0,10" />

                <CollectionView x:Name="DriversCollection"

                                SelectionMode="Single"
                                HeightRequest="300">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <!-- Prikaz vozača -->
                            <Frame BorderColor="#FF4444" CornerRadius="10" Padding="10">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="DriverCard_Tapped" />
                                </Frame.GestureRecognizers>
                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <Frame Grid.Column="0" HeightRequest="50" WidthRequest="50" CornerRadius="25" BackgroundColor="#eee">

                                        <Image Source="{Binding ProfileImage}" Aspect="AspectFill" />
                                    </Frame>
                                    <VerticalStackLayout Grid.Column="1" Margin="10,0,0,0">
                                        <Label Text="{Binding Name}" TextColor="White" FontAttributes="Bold" />
                                        <Label Text="{Binding Car}" TextColor="#aaa" FontSize="12" />
                                        <Label Text="{Binding Price, StringFormat='Cijena: {0}KM'}" TextColor="#aaa" FontSize="12" />
                                    </VerticalStackLayout>
                                    <Label Grid.Column="2" Text="{Binding Rating, StringFormat='{0}★'}" TextColor="#FFD700" FontSize="14" VerticalOptions="Start" />

                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                    

                    <Button Text="Osvježi listu"
                        Clicked="RefreshDrivers_Clicked"
                        BackgroundColor="White"
                        TextColor="Black"
                        CornerRadius="10"
                        Padding="10"
                        Margin="0,10,0,0" />
                
            </StackLayout>
            </ScrollView>
        </Frame>
    </Grid>
</ContentPage>
